<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>.Net (dotnet) - Donal Mee</title> <link rel="shortcut icon" href="https://www.donalmee.com/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="https://www.donalmee.com/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135505936-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-135505936-1', { 'anonymize_ip': true }); </script> <script type="text/javascript" src="https://www.donalmee.com/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="https://www.donalmee.com/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>.Net (dotnet) | Donal Mee</title> <meta name="generator" content="Jekyll v4.1.1" /> <meta property="og:title" content=".Net (dotnet)" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Notes on software and other things." /> <meta property="og:description" content="Notes on software and other things." /> <link rel="canonical" href="https://www.donalmee.com/dotnet/" /> <meta property="og:url" content="https://www.donalmee.com/dotnet/" /> <meta property="og:site_name" content="Donal Mee" /> <script type="application/ld+json"> {"headline":".Net (dotnet)","@type":"WebPage","url":"https://www.donalmee.com/dotnet/","description":"Notes on software and other things.","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://www.donalmee.com/" class="site-title lh-tight"> Donal Mee </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"> <li class="nav-list-item"> <a href="https://www.donalmee.com/" class="nav-list-link">Posts</a> </li><li class="nav-list-item active"><a href="https://www.donalmee.com/dotnet/" class="nav-list-link active">.Net (dotnet)</a></li><li class="nav-list-item"><a href="https://www.donalmee.com/about/" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="https://www.donalmee.com/chef/" class="nav-list-link">Chef</a></li><li class="nav-list-item"><a href="https://www.donalmee.com/fastai/" class="nav-list-link">Fast AI</a></li><li class="nav-list-item"><a href="https://www.donalmee.com/groovy/" class="nav-list-link">Groovy</a></li><li class="nav-list-item"><a href="https://www.donalmee.com/jekyll/" class="nav-list-link">Jekyll</a></li><li class="nav-list-item"><a href="https://www.donalmee.com/jenkins-and-groovy/" class="nav-list-link">Jenkins and Groovy</a></li><li class="nav-list-item"><a href="https://www.donalmee.com/powershell/" class="nav-list-link">Powershell</a></li></ul> </nav> <footer class="site-footer"> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Donal Mee" aria-label="Search Donal Mee" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <button class="btn js-toggle-dark-mode float-right">Dark mode</button> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="net-dotnet"> <a href="#net-dotnet" aria-labelledby="net-dotnet" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> .Net (dotnet) </h1> <ul id="markdown-toc"> <li><a href="#net-assemblies" id="markdown-toc-net-assemblies">.Net assemblies</a> <ul> <li><a href="#what-is-an-assembly" id="markdown-toc-what-is-an-assembly">What is an assembly?</a></li> <li><a href="#what-does-an-assembly-contain" id="markdown-toc-what-does-an-assembly-contain">What does an assembly contain?</a></li> <li><a href="#lets-make-one" id="markdown-toc-lets-make-one">Lets make one</a></li> <li><a href="#creating-a-class-library" id="markdown-toc-creating-a-class-library">Creating a class library</a></li> <li><a href="#assembly-modules" id="markdown-toc-assembly-modules">Assembly modules</a></li> <li><a href="#assemblies-scope-types" id="markdown-toc-assemblies-scope-types">Assemblies scope types</a></li> <li><a href="#assembly-names" id="markdown-toc-assembly-names">Assembly names</a></li> <li><a href="#strongly-named-assemblies" id="markdown-toc-strongly-named-assemblies">Strongly named assemblies</a></li> </ul> </li> <li><a href="#references" id="markdown-toc-references">References</a></li> </ul> <h2 id="net-assemblies"> <a href="#net-assemblies" aria-labelledby="net-assemblies" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> .Net assemblies </h2> <p>These are my notes from <a href="https://www.linkedin.com/learning/clr-assemblies-deployment-for-dot-net-developers/">linkedIn-learning-clr-assemblies</a>. I can recommend the course from <a href="https://www.linkedin.com/learning/instructors/ted-neward?u=2138274">Ted Neward</a>.</p> <h3 id="what-is-an-assembly"> <a href="#what-is-an-assembly" aria-labelledby="what-is-an-assembly" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What is an assembly? </h3> <p>It is a unit of deployment (a binary) in the common-language runtime. It is also a unit of version control, in you can describe the version of the assembly your working with. Assemblies play a role in the security of dotnet, as they can be signed.</p> <p>Assemblies are a collection of types (like interfaces, classes etc). The assembly gathers the types together to form a logical library of functionality. Note, an assembly is not just a library. A dotnet assembly-binary can be built as an executable. Dotnet executables are assemblies, as we shall see.</p> <p>Assembly provides the CLR with data to know about the collection of types, including some meta-data of the types. Microsoft created the assembly concept, after writing a lot of c and c++ that experienced <a href="https://en.wikipedia.org/wiki/DLL_Hell">DLL hell</a>. They took that experience and aimed to improve upon this situation when they developed the assembly.</p> <p>Core principal: assemblies are self-describing, everything the CLR needs to execute the assembly is inside the assembly. This is unlike compiled code in c or c++, as the compiled code also requires headers file to describe the content of the complied code. In contract, the assembly is entirely self-descriptive.</p> <p>Assemblies are also platform-independent to help with portability.</p> <p>Assemblies are bound by name, but their full name is not just the filename (unlike c/c++ <a href="https://en.wikipedia.org/wiki/Dynamic-link_library">dlls</a>). The specification of the fullname is described below, but it contains the version number and potentially a hash.</p> <p>Assembly loading is senstive to version and policy. Not described now, but more information is in the <a href="https://www.linkedin.com/learning/clr-assembly-runtime-loading-for-developers/">CLR assembly loading course</a>.</p> <p>Assemblies are validated by the CLR, it will avoid loading the code, if it’s been tampered with, if the assembly is signed.</p> <h3 id="what-does-an-assembly-contain"> <a href="#what-does-an-assembly-contain" aria-labelledby="what-does-an-assembly-contain" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What does an assembly contain? </h3> <p>A COFF/PE file package. <a href="https://en.wikipedia.org/wiki/COFF">COFF</a> is an old unix format. COFF has been largely replaced in unix by newer <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">ELF</a>. From wiki “perhaps the most widespread use of the COFF format today is in Microsoft’s Portable Executable (PE) format”. <a href="https://en.wikipedia.org/wiki/Portable_Executable">PE</a> is Microsofts extensions or modifications to COFF.</p> <p>An assembly contains:</p> <ul> <li>An assembly manifest (describes whats in the assembly) file;</li> <li>A set of metadata tables in a relational format;</li> <li>A (optional) set of non-code resources.</li> <li>Optional cryptographic hash to secure the contents of the assembly from tampering.</li> </ul> <h3 id="lets-make-one"> <a href="#lets-make-one" aria-labelledby="lets-make-one" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lets make one </h3> <p>So, in visual studio, create a c# console-application project, that’s a simple hello-world example with code like so in Program.cs:</p> <figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="c1">// helloworld assembly, Program.cs
</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">helloworld</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Hello world"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p>When we build the application, we get the helloworld.exe binary. This is apparently a CLR assembly. It’s in binary, so we could look at it with a binary tool. But it would be better to use a binary CLR decoder. Microsoft makes a tool called <code class="language-plaintext highlighter-rouge">ildasm</code>. Ildasm = <a href="https://docs.microsoft.com/en-us/dotnet/framework/tools/ildasm-exe-il-disassembler">Intermediate Language Disassembler</a>. You can find <code class="language-plaintext highlighter-rouge">ildasm</code> if you open the visual-studio developer command prompt. Ildasm is also available in visual-studio menus until ‘tools’.</p> <p><a href="/assets/images/dotnet-assembly-ildasm-helloworld.png"><img src="/assets/images/dotnet-assembly-ildasm-helloworld.png" alt="ildasm helloworld debug" /></a></p> <p>With ildasm (pronounced ‘eye-el-daz-im’) we can see what exactly the binary means, and we can see the contents of the manifest along with the contents and machine instructions (or CLR equivalents, known as <a href="https://en.wikipedia.org/wiki/Common_Intermediate_Language">(common) intermediate language code</a> (C/IL)) for the main program inside the helloworld namespace. All very cool.</p> <p><a href="/assets/images/dotnet-assembly-ildasm-helloworld-all.png"><img src="/assets/images/dotnet-assembly-ildasm-helloworld-all.png" alt="ildasm helloworld all" /></a></p> <p>.ctor is the default constructor that the C# compiler creates for the programmer if they didn’t create one. Every C# class must have a constructor, so we can see here in ildasm what the compiler does to produce runnable CLR code for the programmer.</p> <p>The red-triangle above .ctor provides some class meta-data for the Hellworld.Program. The meta-data is part of the CLR specifiction to help the CLR understand the class. The specification of the CLR is publically available and can be found as <a href="https://www.ecma-international.org/publications/standards/Ecma-335.htm">ECMA standard 335</a>. Though that’s from 2012, so presumably Microsoft have contined to extend it. See Microsoft document page on <a href="https://docs.microsoft.com/en-us/dotnet/standard/components">.NET architectural components</a></p> <p>Inside the .main, we see the CIL itself.</p> <h3 id="creating-a-class-library"> <a href="#creating-a-class-library" aria-labelledby="creating-a-class-library" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating a class library </h3> <p>An assembly tracks the other assemblies it dependents on. So lets create a c# class library, calling it the People component, by adding a new project to the current visual-studio solution.</p> <p>Let’s create a simple Person class within the People assembly/project, that we then want to re-use or reference in the helloworld project.</p> <figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="c1">// People assembly, Person.cs
</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">People</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Age</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="nf">Person</span><span class="p">(</span><span class="kt">string</span> <span class="n">fn</span><span class="p">,</span> <span class="kt">string</span> <span class="n">ln</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">FirstName</span> <span class="p">=</span> <span class="n">fn</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">LastName</span> <span class="p">=</span> <span class="n">ln</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Age</span> <span class="p">=</span> <span class="n">a</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="kt">string</span> <span class="nf">ToString</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">String</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"[Person fn:{0}, ln:{1}, a:{2}]"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">Age</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p>Then we say we want to use it in helloworld program.cs</p> <figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="c1">// helloworld assembly, Program.cs
</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">People</span><span class="p">;</span>  <span class="c1">// here is the new using directive
</span>

<span class="k">namespace</span> <span class="nn">helloworld</span>
<span class="p">{</span>
    <span class="p">...</span></code></pre></figure> <p>We have to add a reference to the assembly in the helloworld project, as otherwise, the project/build-solution doesn’t know where People is coming from.</p> <p><a href="/assets/images/dotnet-assembly-reference-people.png"><img src="/assets/images/dotnet-assembly-reference-people.png" alt="ildasm helloworld all" /></a></p> <p>So let’s update helloworld program to use the Person class.</p> <figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="c1">// helloworld project, program.cs
</span>

<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">People</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">helloworld</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">bloke</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Person</span><span class="p">(</span><span class="s">"Bloke"</span><span class="p">,</span> <span class="s">"Thing"</span><span class="p">,</span> <span class="m">55</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Hello {0}"</span><span class="p">,</span> <span class="n">bloke</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p>Then when we build and run the binary we get</p> <figure class="highlight"><pre><code class="language-cmd" data-lang="cmd">helloworld\bin\Debug&gt;helloworld.exe
Hello [Person fn:Bloke, ln:Thing, a:55]</code></pre></figure> <p>So now, the helloworld.exe assembly should be updated to track the People assembly. Lets look at it with ildasm.</p> <p><a href="/assets/images/dotnet-assembly-ildasm-helloworld-people.png"><img src="/assets/images/dotnet-assembly-ildasm-helloworld-people.png" alt="ildasm helloworld people reference" /></a></p> <p>As we see, it references the new People assembly. Like so:</p> <figure class="highlight"><pre><code class="language-manifest" data-lang="manifest">.assembly extern People
{
  .ver 1:0:0:0
}</code></pre></figure> <p>We can also use ildasm on the People.dll (an assembly can be a dll as well as an executable), which is copied into the build output beside helloworld.exe.</p> <figure class="highlight"><pre><code class="language-cmd" data-lang="cmd">helloworld\helloworld\bin\Debug&gt;dir
 Volume in drive C is Windows
 Volume Serial Number is 82E3-8976

 Directory of 
 helloworld\helloworld\bin\Debug

25/09/2020  10:59    &lt;DIR&gt;          .
25/09/2020  10:59    &lt;DIR&gt;          ..
25/09/2020  10:59             5,120 helloworld.exe
25/09/2020  10:05               189 helloworld.exe.config
25/09/2020  10:59            11,776 helloworld.pdb
25/09/2020  10:05            22,696 helloworld.vshost.exe
25/09/2020  10:05               189 helloworld.vshost.exe.config
19/03/2019  05:46               490 helloworld.vshost.exe.manifest
25/09/2020  10:53             5,120 People.dll
25/09/2020  10:53            13,824 People.pdb
               8 File(s)         59,404 bytes
               2 Dir(s)  158,143,741,952 bytes free</code></pre></figure> <h3 id="assembly-modules"> <a href="#assembly-modules" aria-labelledby="assembly-modules" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Assembly modules </h3> <p>At the bottom of a manifest, you’ll see references to modules. For example in the People dll manifest:</p> <figure class="highlight"><pre><code class="language-manifest" data-lang="manifest">.module People.dll
// MVID: {A4055DBE-97F0-48AA-8335-A76CC7147602}
.imagebase 0x10000000
.file alignment 0x00000200
.stackreserve 0x00100000
.subsystem 0x0003       // WINDOWS_CUI
.corflags 0x00000001    //  ILONLY
// Image base: 0x08B20000</code></pre></figure> <p>Assemblys can contain one or more modules. Turns out the feature isn’t typically used much, most assemblies stick to just one module.</p> <h3 id="assemblies-scope-types"> <a href="#assemblies-scope-types" aria-labelledby="assemblies-scope-types" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Assemblies scope types </h3> <p>Each type defined within an assembly has the assembly name prefixed as a part of the formal or full name of the type. For example the base system object type fullname in an assembly is:</p><pre><code class="language-manifest">[mscorlib]System::Object
</code></pre><p>Note mscorlib is <a href="https://stackoverflow.com/questions/15061977/what-does-mscorlib-stand-for">the original name</a> for the CLR, or when it was called Common Object Runtime Library or something. So the base Object type comes from the CLR assembly. From one of the stackoverflow answers, the mscorlib is the primary library for the common library and contains the following namespaces:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code> System
 System.Collections
 System.Configuration.Assemblies
 System.Diagnostics
 System.Diagnostics.SymbolStore
 System.Globalization
 System.IO
 System.IO.IsolatedStorage
 System.Reflection
 System.Reflection.Emit
 System.Resources
 System.Runtime.CompilerServices
 System.Runtime.InteropServices
 System.Runtime.InteropServices.Expando
 System.Runtime.Remoting
 System.Runtime.Remoting.Activation
 System.Runtime.Remoting.Channels
 System.Runtime.Remoting.Contexts
 System.Runtime.Remoting.Lifetime
 System.Runtime.Remoting.Messaging
 System.Runtime.Remoting.Metadata
 System.Runtime.Remoting.Metadata.W3cXsd2001
 System.Runtime.Remoting.Proxies
 System.Runtime.Remoting.Services
 System.Runtime.Serialization
 System.Runtime.Serialization.Formatters
 System.Runtime.Serialization.Formatters.Binary
 System.Security
 System.Security.Cryptography
 System.Security.Cryptography.X509Certificates
 System.Security.Permissions
 System.Security.Policy
 System.Security.Principal
 System.Text
 System.Threading
 Microsoft.Win32 
</code></pre></div></div> <h3 id="assembly-names"> <a href="#assembly-names" aria-labelledby="assembly-names" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Assembly names </h3> <p>The assembly name is not the file-name. In c/c++, the name of the dll is the point of uniqueness and a lot of different builds of the dlls had the same filename that helped cause dll hell. Assemblies, to solve that, determined that the file-name along was not an appropriate means to create a unique id.</p> <p>The assembly name is made up of 4 parts:</p> <ul> <li>the title of the assembly (common used name);</li> <li>a version number (four-part digited number: major.minor.buildnumber.arbitray-number);</li> <li>(optional) culture-code (helps with internationalisation so a given assembly can have different resources if it’s a GB version or french version or whatever); and</li> <li>(optional) public key token.</li> </ul> <p>These four parts uniquely identify an assembly. So even if two developers choose the same name (say they both create a ‘Util’ library), the fullname <em>can</em> be different.</p> <p>Looking at the manifest reference for the People dll in helloworld.exe manifest:</p> <figure class="highlight"><pre><code class="language-manifest" data-lang="manifest">.assembly extern People
{
  .ver 1:0:0:0
}</code></pre></figure> <p>If we look at the .assembly section of the helloworld assembly, this bit of the manifest describes the helloworld assembly itself, with things like who the author is, the copyright notice, what dotnet framework version is used, a unique guid (for COM).</p> <p>The stuff in brackets <code class="language-plaintext highlighter-rouge">()</code> is the ascii hexademical representation of the value for each of these pieces of meta data and on the right, isdalm has converted it to characters.</p> <figure class="highlight"><pre><code class="language-manifest" data-lang="manifest">// Metadata version: v4.0.30319
.assembly extern mscorlib
{
  .publickeytoken = (B7 7A 5C 56 19 34 E0 89 )                         // .z\V.4..
  .ver 4:0:0:0
}
.assembly extern People
{
  .ver 1:0:0:0
}
.assembly helloworld
{
  .custom instance void [mscorlib]System.Runtime.CompilerServices.CompilationRelaxationsAttribute::.ctor(int32) = ( 01 00 08 00 00 00 00 00 ) 
  .custom instance void [mscorlib]System.Runtime.CompilerServices.RuntimeCompatibilityAttribute::.ctor() = ( 01 00 01 00 54 02 16 57 72 61 70 4E 6F 6E 45 78   // ....T..WrapNonEx

  // --- The following custom attribute is added automatically, do not uncomment -------
  //  .custom instance void [mscorlib]System.Diagnostics.DebuggableAttribute::.ctor(valuetype [mscorlib]System.Diagnostics.DebuggableAttribute/DebuggingModes) = ( 01 00 07 01 00 00 00 00 ) 

  .custom instance void [mscorlib]System.Reflection.AssemblyTitleAttribute::.ctor(string) = ( 01 00 0A 68 65 6C 6C 6F 77 6F 72 6C 64 00 00 )    // ...helloworld..
  .custom instance void [mscorlib]System.Reflection.AssemblyDescriptionAttribute::.ctor(string) = ( 01 00 00 00 00 ) 
  .custom instance void [mscorlib]System.Reflection.AssemblyConfigurationAttribute::.ctor(string) = ( 01 00 00 00 00 ) 
  .custom instance void [mscorlib]System.Reflection.AssemblyCompanyAttribute::.ctor(string) = ( 01 00 00 00 00 ) 
  .custom instance void [mscorlib]System.Reflection.AssemblyProductAttribute::.ctor(string) = ( 01 00 0A 68 65 6C 6C 6F 77 6F 72 6C 64 00 00 )    // ...helloworld..
  .custom instance void [mscorlib]System.Reflection.AssemblyCopyrightAttribute::.ctor(string) = ( 01 00 12 43 6F 70 79 72 69 67 68 74 20 C2 A9 20   // ...Copyright .. 
  .custom instance void [mscorlib]System.Reflection.AssemblyTrademarkAttribute::.ctor(string) = ( 01 00 00 00 00 ) 
  .custom instance void [mscorlib]System.Runtime.InteropServices.ComVisibleAttribute::.ctor(bool) = ( 01 00 00 00 00 ) 
  .custom instance void [mscorlib]System.Runtime.InteropServices.GuidAttribute::.ctor(string) = ( 01 00 24 33 63 61 30 38 30 34 63 2D 30 30 37 31   // ..$3ca0804c-0071
  .custom instance void [mscorlib]System.Reflection.AssemblyFileVersionAttribute::.ctor(string) = ( 01 00 07 31 2E 30 2E 30 2E 30 00 00 )             // ...1.0.0.0..
  .custom instance void [mscorlib]System.Runtime.Versioning.TargetFrameworkAttribute::.ctor(string) = ( 01 00 1C 2E 4E 45 54 46 72 61 6D 65 77 6F 72 6B   // ....NETFramework
  .hash algorithm 0x00008004
  .ver 1:0:0:0
}
.module helloworld.exe
// MVID: {5313BE15-88A5-47B5-95F9-B674A6F1D521}
.imagebase 0x00400000
.file alignment 0x00000200
.stackreserve 0x00100000
.subsystem 0x0003       // WINDOWS_CUI
.corflags 0x00020003    //  ILONLY 32BITPREFERRED
// Image base: 0x032B0000</code></pre></figure> <p>The custom attributes like description and author come from the visual-studio generated AssemblyInfo.cs file in the properties area of the project. If you look in there, you can see whether these values are coming from:</p> <figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="c1">// helloworld-project, AssemblyInfo.cs
</span>
<span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Runtime.CompilerServices</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>

<span class="c1">// General Information about an assembly is controlled through the following 
</span>
<span class="c1">// set of attributes. Change these attribute values to modify the information
</span>
<span class="c1">// associated with an assembly.
</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyTitle</span><span class="p">(</span><span class="s">"helloworld"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyDescription</span><span class="p">(</span><span class="s">""</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyConfiguration</span><span class="p">(</span><span class="s">""</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyCompany</span><span class="p">(</span><span class="s">""</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyProduct</span><span class="p">(</span><span class="s">"helloworld"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyCopyright</span><span class="p">(</span><span class="s">"Copyright ©  2020"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyTrademark</span><span class="p">(</span><span class="s">""</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyCulture</span><span class="p">(</span><span class="s">""</span><span class="p">)]</span>

<span class="c1">// Setting ComVisible to false makes the types in this assembly not visible 
</span>
<span class="c1">// to COM components.  If you need to access a type in this assembly from 
</span>
<span class="c1">// COM, set the ComVisible attribute to true on that type.
</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">ComVisible</span><span class="p">(</span><span class="k">false</span><span class="p">)]</span>

<span class="c1">// The following GUID is for the ID of the typelib if this project is exposed to COM
</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">Guid</span><span class="p">(</span><span class="s">"3ca0804c-0071-4e50-9a58-8a8d1ed584a4"</span><span class="p">)]</span>

<span class="c1">// Version information for an assembly consists of the following four values:
</span>
<span class="c1">//
</span>
<span class="c1">//      Major Version
</span>
<span class="c1">//      Minor Version 
</span>
<span class="c1">//      Build Number
</span>
<span class="c1">//      Revision
</span>
<span class="c1">//
</span>
<span class="c1">// You can specify all the values or you can default the Build and Revision Numbers 
</span>
<span class="c1">// by using the '*' as shown below:
</span>
<span class="c1">// [assembly: AssemblyVersion("1.0.*")]
</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyVersion</span><span class="p">(</span><span class="s">"1.0.0.0"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyFileVersion</span><span class="p">(</span><span class="s">"1.0.0.0"</span><span class="p">)]</span></code></pre></figure> <h3 id="strongly-named-assemblies"> <a href="#strongly-named-assemblies" aria-labelledby="strongly-named-assemblies" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Strongly named assemblies </h3> <p>Requires a public/private key pair. Digitally signed using that pair. This helps secure the assembly from tampering. When you create, compile and deploy code, dotnet should be able to discover and preventing the code being loaded if it’s been tampered with.</p> <p>For example, in metadata, the reference to the mscorlib version 4 supplies a shortened public-key token. This is produced by microsofts private/public pair they used to sign the assemlby with, and this shortened token is used by the runtime to check the mscorlib assembly at runtime.</p> <figure class="highlight"><pre><code class="language-manifest" data-lang="manifest">.assembly extern mscorlib
{
  .publickeytoken = (B7 7A 5C 56 19 34 E0 89 )                         // .z\V.4..
  .ver 4:0:0:0
}</code></pre></figure> <p>The <code class="language-plaintext highlighter-rouge">sn</code> tool can be used after the assembly is compiled to doing the signing.</p> <p>You want to use sn to create the key pair, and output it to file:</p> <figure class="highlight"><pre><code class="language-cmd" data-lang="cmd">sn -k output_file.snk</code></pre></figure> <p>Then inside the AssemblyInfo.cs we can use the attribute AssemblyKeyFile to tell the compiler to use it to produce a strongly named assembly.</p> <figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="c1">// AssemblyInfo.cs, note the file-path is relatively to the project directory.
</span>
<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">AssemblyKeyFile</span><span class="p">(</span><span class="s">"output_file.snk"</span><span class="p">)]</span></code></pre></figure> <h2 id="references"> <a href="#references" aria-labelledby="references" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> References </h2> <ul> <li><a href="https://www.linkedin.com/learning/clr-assemblies-deployment-for-dot-net-developers/">linkedIn-learning-clr-assemblies</a></li> <li><a href="https://www.linkedin.com/learning/instructors/ted-neward?u=2138274">ted-neward</a></li> <li><a href="https://en.wikipedia.org/wiki/DLL_Hell">dll-hell-wiki</a></li> <li><a href="https://en.wikipedia.org/wiki/Dynamic-link_library">dll-wiki</a></li> <li><a href="https://www.linkedin.com/learning/clr-assembly-runtime-loading-for-developers/">linkedin-learning-assembly-loading</a></li> <li><a href="https://en.wikipedia.org/wiki/COFF">coff-wiki</a></li> <li><a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">elf-wiki</a></li> <li><a href="https://en.wikipedia.org/wiki/Portable_Executable">pe-wiki</a></li> <li><a href="https://docs.microsoft.com/en-us/dotnet/framework/tools/ildasm-exe-il-disassembler">microsoft-docs-ildasm</a></li> <li><a href="https://en.wikipedia.org/wiki/Common_Intermediate_Language">cil-wiki</a></li> <li><a href="https://www.ecma-international.org/publications/standards/Ecma-335.htm">ecma-standard-335</a></li> <li><a href="https://docs.microsoft.com/en-us/dotnet/standard/components">microsoft-docs-dotnet-components</a></li> <li><a href="https://stackoverflow.com/questions/15061977/what-does-mscorlib-stand-for">stack-what-does-mscorlib-stand-for</a></li> </ul> </div> </div> <div class="search-overlay"></div> </div> <script> const toggleDarkMode = document.querySelector('.js-toggle-dark-mode'); jtd.addEvent(toggleDarkMode, 'click', function(){ if (jtd.getTheme() === 'dark') { jtd.setTheme('light'); toggleDarkMode.textContent = 'Dark mode'; } else { jtd.setTheme('dark'); toggleDarkMode.textContent = 'Light mode'; } }); </script> </body> </html>
